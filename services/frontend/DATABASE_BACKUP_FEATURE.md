# Функциональность дампа и восстановления базы данных

## Обзор

Добавлена возможность экспорта и импорта всей базы данных IndexedDB в JSON формат. Это позволяет пользователям создавать резервные копии своих данных и восстанавливать их при необходимости.

## Функциональность

### Экспорт данных
- Экспортирует все плейлисты и их треки
- Экспортирует все обложки альбомов (в формате base64)
- Создает JSON файл с метаданными (версия, дата создания)
- Автоматически скачивает файл с именем `playlisto-dump-YYYY-MM-DD.json`

### Импорт данных
- Загружает данные из JSON файла
- Полностью заменяет существующие данные
- Восстанавливает все плейлисты, треки и обложки
- Автоматически перезагружает данные в интерфейсе

## Структура дампа

```typescript
interface DatabaseDump {
  version: string;           // Версия формата дампа
  timestamp: string;         // Дата и время создания дампа
  playlists: Playlist[];     // Все плейлисты
  covers: Array<{            // Все обложки
    url: string;             // URL обложки
    base64: string;          // Обложка в формате base64
  }>;
}
```

## Компоненты

### DatabaseBackup
Расположен в `src/shared/components/DatabaseBackup/DatabaseBackup.tsx`

**Функции:**
- Кнопка экспорта данных
- Кнопка импорта данных (с выбором файла)
- Обработка ошибок
- Индикаторы загрузки
- Предупреждение о замене данных

**Пропсы:**
- `onSuccess?: () => void` - колбэк при успешной операции
- `onError?: (error: string) => void` - колбэк при ошибке

### Утилиты дампа
Расположены в `src/infrastructure/storage/database-dump.ts`

**Основные функции:**
- `exportDatabase()` - экспорт всей базы данных
- `importDatabase(dump)` - импорт данных из дампа
- `downloadDatabaseDump(dump)` - скачивание файла
- `readDatabaseDumpFromFile(file)` - чтение файла дампа

## Интеграция с Settings

Компонент `DatabaseBackup` интегрирован в настройки приложения (`src/shared/components/Settings/Settings.tsx`):

- Добавлена секция "База данных" с иконкой Database
- Отображается между секциями Spotify и информации о приложении
- Показывает ошибки операций в том же стиле, что и другие ошибки

## Обновления в IndexedDB

Добавлены новые методы в `IndexedDBStorage`:

```typescript
interface StorageService {
  // ... существующие методы
  getAllCovers: () => Promise<Array<{ url: string; base64: string }>>;
  clearDatabase: () => Promise<void>;
}
```

## Безопасность

### Предупреждения
- При импорте показывается предупреждение о замене данных
- Рекомендуется создать резервную копию перед импортом

### Валидация
- Проверяется формат JSON файла
- Проверяется наличие обязательных полей в дампе
- Обрабатываются ошибки чтения файла

## Использование

### Экспорт данных
1. Откройте настройки приложения (иконка пользователя)
2. В секции "База данных" нажмите "Экспорт данных"
3. Файл автоматически скачается

### Импорт данных
1. Откройте настройки приложения
2. В секции "База данных" нажмите "Импорт данных"
3. Выберите JSON файл с дампом
4. Подтвердите замену данных
5. Данные будут восстановлены

## Обработка ошибок

### Возможные ошибки
- "Неверный формат файла" - файл не является валидным JSON
- "Ошибка экспорта базы данных" - проблемы с доступом к IndexedDB
- "Ошибка импорта базы данных" - проблемы при восстановлении данных

### Отображение ошибок
- Ошибки показываются в красном блоке под кнопками
- Автоматически очищаются при успешной операции

## Технические детали

### Производительность
- Экспорт: зависит от количества плейлистов и обложек
- Импорт: очищает базу данных перед восстановлением
- Обложки хранятся в base64 формате для полного восстановления

### Совместимость
- Формат дампа версионируется для будущих изменений
- Текущая версия: 1.0.0
- Обратная совместимость будет поддерживаться

### Ограничения
- Размер файла дампа зависит от количества обложек
- Браузерные ограничения на размер скачиваемых файлов
- Рекомендуется регулярное создание резервных копий

## Будущие улучшения

### Возможные дополнения
- Сжатие дампа для уменьшения размера файла
- Выборочный экспорт (только плейлисты без обложек)
- Автоматическое создание резервных копий
- Синхронизация с облачным хранилищем
- Валидация данных перед импортом

### Мониторинг
- Логирование операций экспорта/импорта
- Статистика использования функции
- Отслеживание ошибок 