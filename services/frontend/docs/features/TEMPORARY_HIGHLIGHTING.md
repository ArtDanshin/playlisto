# Временная подсветка новых треков

## Проблема
Ранее флаг `isNew` сохранялся в базе данных, что приводило к постоянной подсветке новых треков даже после перезагрузки страницы.

## Решение
Флаг `isNew` сохраняется в базе данных для отображения, но очищается при загрузке из базы данных и при переключении между плейлистами, обеспечивая временную подсветку только сразу после обновления плейлиста.

## Изменения в коде

### PlaylistStore (store/playlist-store.ts)

#### Функция loadPlaylists
```typescript
loadPlaylists: async () => {
  // ...
  const savedPlaylists = await playlistDB.getAllPlaylists();
  
  // Очищаем флаг isNew при загрузке из базы данных
  const cleanPlaylists = savedPlaylists.map(playlist => ({
    ...playlist,
    tracks: playlist.tracks.map(track => ({
      ...track,
      isNew: undefined, // Удаляем флаг isNew при загрузке
    })),
  }));
  
  set({ playlists: cleanPlaylists });
}
```

#### Функция setCurrentPlaylist
```typescript
setCurrentPlaylist: (playlist) => {
  if (playlist) {
    // Очищаем флаг isNew при переключении на плейлист
    const cleanPlaylist = {
      ...playlist,
      tracks: playlist.tracks.map(track => ({
        ...track,
        isNew: undefined, // Удаляем флаг isNew
      })),
    };
    set({ currentPlaylist: cleanPlaylist });
  } else {
    set({ currentPlaylist: null });
  }
}
```

## Поведение

### До изменений
- ✅ Новые треки подсвечивались зеленым
- ❌ Подсветка сохранялась после перезагрузки страницы
- ❌ Подсветка оставалась даже при повторном открытии плейлиста

### После изменений
- ✅ Новые треки подсвечиваются зеленым сразу после обновления
- ✅ Подсветка исчезает при перезагрузке страницы
- ✅ Подсветка исчезает при повторном открытии плейлиста
- ✅ Флаг `isNew` не сохраняется в базе данных

## Техническая реализация

### Принцип работы
1. При обновлении плейлиста новые треки помечаются флагом `isNew: true`
2. Плейлист отображается с подсветкой новых треков
3. Флаг `isNew` сохраняется в базе данных для отображения
4. При загрузке из базы данных флаг `isNew` очищается
5. При переключении между плейлистами флаг `isNew` также очищается

### Преимущества
- **Временность**: Подсветка только для текущей сессии
- **Чистота данных**: База данных не содержит временных флагов
- **Производительность**: Нет лишних данных в хранилище
- **UX**: Пользователь видит новые треки только когда это актуально

## Сценарии использования

### Сценарий 1: Обновление плейлиста
1. Пользователь загружает обновленный плейлист
2. Новые треки подсвечиваются зеленым
3. Пользователь видит, какие треки добавлены
4. При перезагрузке страницы подсветка исчезает

### Сценарий 2: Добавление нового плейлиста
1. Пользователь загружает новый плейлист
2. Все треки могут быть подсвечены как новые
3. При перезагрузке страницы подсветка исчезает

### Сценарий 3: Повторное открытие плейлиста
1. Пользователь открывает плейлист с новыми треками
2. Подсветка отсутствует (треки уже не новые)
3. Интерфейс остается чистым 