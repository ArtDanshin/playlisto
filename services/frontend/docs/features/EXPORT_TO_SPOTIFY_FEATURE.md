# Экспорт плейлистов в Spotify

## Описание функционала

Добавлен новый функционал для экспорта плейлистов из приложения в Spotify. Пользователи могут создавать новые плейлисты или обновлять существующие в своем аккаунте Spotify.

## Возможности

### 1. Создание нового плейлиста
- Экспорт всех распознанных треков с сохранением порядка
- Автоматическое создание плейлиста в аккаунте пользователя
- Открытие созданного плейлиста в Spotify после экспорта

### 2. Обновление существующего плейлиста
- Поддержка ссылок на плейлисты Spotify
- Проверка принадлежности плейлиста авторизованному пользователю
- Сравнение треков между приложением и Spotify
- Гибкие опции синхронизации

## Опции синхронизации

При обновлении существующего плейлиста доступны следующие опции:

1. **Добавить новые треки** - добавляет треки из приложения, которых нет в Spotify
2. **Удалить отсутствующие треки** - удаляет треки из Spotify, которых нет в приложении
3. **Синхронизировать порядок треков** - устанавливает порядок треков как в приложении

## Интерфейс

### Кнопка экспорта
- Расположена рядом с кнопкой "Распознать треки" в заголовке списка треков
- Доступна только при наличии текущего плейлиста
- Отображается иконка музыки и текст "Экспорт в Spotify"

### Диалог экспорта
- Выбор режима экспорта (новый/существующий)
- Поле для ввода ссылки на плейлист Spotify (для режима "существующий")
- Отображение статистики по трекам с указанием различий в порядке
- Опции синхронизации (для режима "существующий")
- Индикация процесса загрузки и ошибок
- Сообщения об успешном экспорте с кнопкой перехода к плейлисту
- Автоматическая очистка состояния при закрытии диалога

## Техническая реализация

### Компоненты
- `ExportToSpotifyDialog` - основной компонент диалога экспорта
- Интеграция с `SortableTrackList` и `TrackList`

### API интеграция
- Использование существующего `spotifyApi` для работы с Spotify API
- Поддержка создания плейлистов (`POST /me/playlists`)
- Поддержка обновления плейлистов (`PUT /playlists/{id}/tracks`)
- Получение информации о плейлистах (`GET /playlists/{id}`)

### Безопасность
- Проверка авторизации пользователя
- Валидация принадлежности плейлиста пользователю
- Обработка ошибок API

## Использование

### Экспорт нового плейлиста
1. Нажмите кнопку "Экспорт в Spotify"
2. Выберите режим "Создать новый"
3. Нажмите "Экспортировать"
4. Плейлист будет создан и появится сообщение об успехе с кнопкой для перехода

### Обновление существующего плейлиста
1. Нажмите кнопку "Экспорт в Spotify"
2. Выберите режим "Обновить существующий"
3. Вставьте ссылку на плейлист Spotify
4. Настройте опции синхронизации
5. Нажмите "Экспортировать"

## Требования

- Авторизация в Spotify
- Наличие распознанных треков в плейлисте
- Для обновления существующего плейлиста - плейлист должен принадлежать пользователю

## Ограничения

- Экспортируются только треки, связанные со Spotify (имеющие `spotifyId`)
- Максимальное количество треков в плейлисте Spotify - 10,000
- Обновление плейлиста полностью заменяет его содержимое

## Улучшения UX

- Диалог остается открытым после экспорта для отображения результата
- Автоматическая очистка состояния диалога при закрытии
- Информативные сообщения об успешном экспорте
- Кнопка для перехода к созданному плейлисту
- Умная статистика различий:
  - При различиях только в порядке: показывается только "Различается только порядок треков"
  - При различиях в составе: показываются новые/удаленные треки + порядок
  - При полном совпадении: показывается только количество общих треков 